<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="theme-color" content="#0C171C">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="icon" type="image/png" href="/favicon-32x32.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Playball&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/default.min.css">
  <link rel="stylesheet" href="/styles/monokai.css">

  <title>Scoping Javascript closures in loops</title>
  <meta content="Hello, I'm Brad Harris. I help build products with software, and love the web ❤️. I live in Castle Rock, Colorado and stay busy enjoying life with my family." name="description">

  
  <meta property="og:url" content="https://bradharris.dev/old-school/2009-01-23/scoping-javascript-closures-in-loops/">
  <meta property="og:title" content="Scoping Javascript closures in loops">
  
    <meta property="og:image" content="https://bradharris.dev/post-thumbnails/brad.jpg">
  
  
  
    <meta property="og:description" content="Hello, I'm Brad Harris. I help build products with software, and love the web ❤️. I live in Castle Rock, Colorado and stay busy enjoying life with my family.">
  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@selfc0ntained">
  <meta name="twitter:creator" content="@selfc0ntained">
  <meta name="twitter:title" content="Scoping Javascript closures in loops">
  
  
    <meta name="twitter:description" content="Hello, I'm Brad Harris. I help build products with software, and love the web ❤️. I live in Castle Rock, Colorado and stay busy enjoying life with my family.">
  
  
    <meta name="twitter:image" content="https://bradharris.dev/post-thumbnails/brad.jpg">
  
  
    <meta name="twitter:image:alt" content="Picture of Brad Harris">
  

  <script>
    (() => {
      // prevent flashing of light=>dark mode on load
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches
      const darkEnabled = localStorage.getItem('dark-mode')
      if(darkEnabled === "true" || (prefersDark && darkEnabled !== "false")) {
        document.documentElement.classList.toggle("dark-mode", true);
      }
    })();
  </script>
</head>
<body>
  <div id="main-layout">
    <header>
      <nav>
        <ul>
          <li><a href="/">bradharris.dev</a></li>
          <li><a href="/about/">about</a></li>
          <li><a href="/posts/">posts</a></li>
        </ul>
      </nav>
      <dark-mode-toggle key="dark-mode" darkmode-class="dark-mode">
    </dark-mode-toggle></header>


    <main class="post">
      
<h1>Scoping Javascript closures in loops</h1>
<time>January 23rd, 2009</time>

<article><p>It must have been something I ate, cause this is like the third post in 2 days I think!  This is a quick one, but super handy to know if you don't already.  There is  semi-common problem I run into, and it has to do with scoping of closures inside of loops.  Lets get straight to the code so its easier to understand what I'm talking about:</p>
<pre><code class="language-html hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://yui.yahooapis.com/2.6.0/build/utilities/utilities.js"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="language-javascript">
	<span class="hljs-keyword">var</span> values = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>];
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> idx <span class="hljs-keyword">in</span> values) {
		<span class="hljs-comment">//First Test - will have incorrent scoping</span>
		<span class="hljs-variable constant_">YAHOO</span>.<span class="hljs-property">util</span>.<span class="hljs-property">Event</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-variable language_">window</span>, <span class="hljs-string">'load'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
			<span class="hljs-variable constant_">YAHOO</span>.<span class="hljs-property">util</span>.<span class="hljs-property">Dom</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'wrong-scope'</span>).<span class="hljs-property">innerHTML</span> += <span class="hljs-string">' '</span>+values[idx]+<span class="hljs-string">' '</span>;
		});
		<span class="hljs-comment">//Second Test - scoping will be correct</span>
		<span class="hljs-variable constant_">YAHOO</span>.<span class="hljs-property">util</span>.<span class="hljs-property">Event</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-variable language_">window</span>, <span class="hljs-string">'load'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">scopedValue</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
				<span class="hljs-variable constant_">YAHOO</span>.<span class="hljs-property">util</span>.<span class="hljs-property">Dom</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'right-scope'</span>).<span class="hljs-property">innerHTML</span> += <span class="hljs-string">' '</span>+scopedValue+<span class="hljs-string">' '</span>;
			}
		}(values[idx]));

	}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"wrong-scope"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Wrong Scope<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"right-scope"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Right Scope<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>In this example, there is a simple array of ordered values, and then a loop over those values.  For each iteration of the loop, there is an onload listener added that will dump that value into a div.  You'll see the first loop always dumps 9, because the scoping is wrong when the closure executes, and the last time through the loop sets the scope of <code>values[idx]</code>.</p>
<p>The second section does some unique handy-work to correct the scoping.  A listener is added like before, but the closure is created in a specific fashion in order to get the scope to be the way we want at runtime.  For the closure in the second section, we create a self-executing function, passing in a parameter that is the current value in our array of numbers.  That function runs, and returns another function that does the appending to the div of the value.  This second, <em>inner-function</em> is what will execute on page load.  Because of the outer-function we immediately called, the variable passed into it, the current value from our array, will be available, and properly scoped for our inner-function.</p>
<p><img src="/images/scoping.gif" alt="scoping"></p>
<p>This is a handy trick when you have a situation where you are looping over a collection, and are providing some type of callback/closure for each entry, but need some proper scoping.</p>
</article>
    </main>
    <footer>
      <span>© 2023 Brad Harris</span>
      <a href="https://twitter.com/selfc0ntained" rel="me"><img src="/icons/twitter.png" width="15" class="glow-2"></a>
      <a href="https://github.com/selfcontained" rel="me"><img src="/icons/github.png" width="15" class="glow"></a>
      <a href="https://www.linkedin.com/in/bradharris/" rel="me"><img src="/icons/linkedin.png" width="15" class="glow-3"></a>
      <dark-mode-toggle key="dark-mode" darkmode-class="dark-mode">
    </dark-mode-toggle></footer>
  </div>
  <script src="/scripts/dark-mode-toggle.js"></script>
  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-49NP8W3EPZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-49NP8W3EPZ');
    </script>
  

</body></html>